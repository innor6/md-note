

**数据库**

长期存储、有组织、可共享的大量数据的集合

**数据库模式**

模式（schema）：关系数据表的表头

关系（relation）：一个规范化的二维表

模式描述数据关系，即一条记录由哪些数据组成。

**数据库特点**

- 数据结构化
- 数据的共享性高，冗余度低
- 数据独立性高
- 数据由DBMS统一管理和控制

**数据库系统**

采用了数据库技术的计算机系统（包括数据库、OS、DBMS、应用程序开发工具、应用程序、用户）



**数据库系统的三个问题**

- DBMS的实现
- 数据库结构的设计
- 数据的存取



**DBMS的实现**

一些关注点：元组在磁盘上的存储、高级查询处理优化、缓冲区管理、并发控制（事务处理）、索引、可靠性、应用程序编程接口（API）、数据字典组织

**数据库结构的设计**

数据冗余
更新异常
插入异常
删除异常

主要问题：到底什么样的数据库模式才合理？怎么分解才能满足要求？标准是什么？如何实现？

**数据的存取问题**





# 三级模式，两级映像

模式：数据库的逻辑结构特征

**三级模式**

- 外模式（view level）
- 概念模式（logical level）
- 内模式（physical level）

why 3 层？：增加数据库的可维护性能

概念模式（逻辑模式）：

- 数据库中全体数据的逻辑结构和特征的描述，即所有表的定义
- 一个数据库只有一个概念模式

外模式：

- 单个用户所看到的局部数据的逻辑结构特征
- 派生自概念模式

内模式（存储模式）：

- 物理结构和存储方式（文件）
- 索引结构

**两级映像**

外模式/模式映像：数据的逻辑独立性（概念模式改变时，可修改映像，保持外模式不变）

模式/内模式映像：物理独立性（内部存储结构改变时，修改映像，可保持逻辑模式不变）

独立性：修改逻辑模式/内模式，能够保证外模式不变，也就保证了用户程序不用改变。

### 码

- 超码：在关系中能唯一标识一个元组的属性集（多个属性一起）称为关系模式的超码
- 候选码：不含多余属性的超码
  - 主属性：包含在候选码中的属性
  - 非主属性：不包含在任何候选码中的属性
- 主码（码）：用户选作元组标识的一个候选码称为主码，其余的候选码称为替换码(Alternate Key)

求主码的方法：

先找出所有函数依赖左部的属性，然后消除这些属性间依赖，剩下的一起构成一个主码。

### 关系模式

- 关系模式：描述关系的逻辑结构和特征，二维表格的表头
- 关系：关系模式的实例，二维表

### 最小函数依赖集

- 每个FD的右边只有一个属性
- 每个FD左部不可约
- F 与 F-FDi 不等价

**求最小函数依赖**：（利用**分解律、增广律**）

1. 所有依赖右边化为单属性
2. 消除左侧冗余属性
3. 消除冗余的函数依赖
   - 方法：从第一个依赖开始，从F中去掉它，假设为X→Y，则在剩下的依赖中求X的闭包X+，如果X+还是包含Y，则去掉该依赖。（即F去掉X→Y后，如果X还能推出Y，则该FD冗余）
   - 闭包：指X在通过函数依赖F能够推出的所有属性，包括X自己。

**求候选码**：

对某个属性/属性集，求它的闭包，如果闭包包含所有属性，则是候选码。



关系代数

三类完整性：实体完整性（空值）、参照完整性（外码）、用户自定义完整性



# 模式设计

### 问题

- 数据冗余
- 更新异常：修改某个值，必须修改多行
- 插入异常：不能插入有部分空值的记录
- 删除异常：删除某行，同时会删除其他信息

### 模式分解

属性集的分解、函数依赖的分解

- 无损连接：分解后的属性集，自然连接后与原属性相同
  - 验证无损连接：满足函数依赖 R1∩R2 → R1-R2
- 保持函数依赖：分解后的各属性集中的函数依赖，union后可得到原来的函数依赖

### 范式

范式越高，模式设计问题越少，但连接运算多，查询效率低，但模式分解到何时才结束？

- 1NF：属性值只能含一个值
- 2NF：非主属性<u>完全依赖</u>于主码（消除局部依赖）
- 3NF：非主属性<u>不传递依赖</u>于主码（消除传递依赖）

2NF、3NF都只考虑了FD为（xxx→非主属性）的情况，而没考虑（非主属性→主属性）的函数依赖（有多个候选码时会出现）。

- BCNF：FD的左端必须是候选码

分解到BCNF不一定能保持函数依赖！

### 模式分解的三个算法

1. 保持函数依赖地分解到3NF
2. 无损连接且保持函数依赖地分解到3NF
3. 无损连接地分解R到BCNF



# 数据库设计

设计步骤：

- 概念设计：ER
- 逻辑设计：关系模式
- 物理设计



ER模型

- 实体：一个实体具有唯一标识，即码（key）。
- 联系

ER图

矩形：实体

椭圆：实体的属性

菱形：联系，两段写上基数（1:N, M:N, 1:1）



。。。



# 磁盘

扇区是磁盘存储的最小单位。

块是磁盘与主存之间传输的最小单位，包含多个扇区。

计算：

- 磁盘的容量 = 盘面 * 磁道/盘面 * 扇区/磁道 *字节/扇区

  注：盘面是盘片的两倍，磁道数等于柱面数。

- 位密度 = 磁道容量 / (磁道周长 * 非间隙比例)

- 磁盘旋转一周的时间：7200r/min -> 1000*1/(7200/60)=8.33ms

- 一个块的传输时间：磁头经过的（扇区+间隙）所占一圈的度数 / 360 * 转一周时间

  如：一圈256个扇区，256个间隙，间隙占10%，则度数为（16/256 * 360 * 90% + 15/256 * 360 * 10% = 22.36度）

- 平均寻道时间：启动时间 + 移动过1/3的磁道的时间

- 平均旋转延迟：磁盘旋转半周的时间

- 磁盘的延迟/存取时间：寻道时间 + 旋转延迟 + 传输时间

