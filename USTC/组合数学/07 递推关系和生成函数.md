# 7 递推关系和生成函数

### 导引：斐波那契数列

$$
f_n = f_{n-1} + f_{n-2}
$$

初始值
$$
f_0=0,\quad f_1=1
$$
前n项和
$$
s_n = f_0 + f_1 +f_2+ \dots+f_n=f_{n+2}-1
$$
归纳法证明：先证s0成立，假设对n成立，然后证明n+1时也成立。

**求斐波那契数的公式**

对于递推关系式
$$
f_n - f_{n-1} - f_{n-2} = 0
$$
设
$$
f_n = q^n
$$
递推关系式变为：
$$
\begin{align}
q^n - q^{n-1} - q^{n-2} &= 0 \\
q^{n-2}(q^2-q-1)&=0
\end{align}
$$
由于q≠0，方程的根为：
$$
q_1=\frac{1+\sqrt{5}}{2}, \quad q_2=\frac{1-\sqrt{5}}{2}
$$
由于递推关系是线性的（f的幂为1），且是齐次的（rhs为零），所以递推关系的通解为：
$$
f_n=c_1\begin{pmatrix}\frac{1+\sqrt{5}}{2}\end{pmatrix}^n + c_2\begin{pmatrix}\frac{1-\sqrt{5}}{2}\end{pmatrix}^n
$$
代入初始值 f0=0 和 f1=1，解方程组可以得到特解：
$$
f_n=\frac{1}{\sqrt{5}}\begin{pmatrix}\frac{1+\sqrt{5}}{2}\end{pmatrix}^n - \frac{1}{\sqrt{5}}\begin{pmatrix}\frac{1-\sqrt{5}}{2}\end{pmatrix}^n
$$
**斐波那契数与二项式系数**

在帕斯卡三角形从左下到右上的对角线上的二项式系数的和是斐波那契数：
$$
f_n=\begin{pmatrix}n-1\\0\end{pmatrix}+\begin{pmatrix}n-2\\1\end{pmatrix}+\begin{pmatrix}n-3\\2\end{pmatrix}+\dots+\begin{pmatrix}n-t\\t-1\end{pmatrix}
$$
其中 t = (n+1)/2（下取整）。





### 常用级数

**牛顿二项式定理**：
$$
\frac{1}{(1-x)^n} = \sum_{k=0}^\infty \begin{pmatrix}n+k-1\\k\end{pmatrix} x^k \quad\quad (|x| < 1)
$$
**几何级数**：
$$
\frac{1}{1-x} = 1 + x + x^2 + \dots + x^n + \dots
$$

- 要求 |x| < 1
- 等比数列求和公式 (1-q^n)/(1-q) 的极限。

**指数函数**：
$$
e^x = 1 + \frac{x}{1!} + \frac{x^2}{2!} + \frac{x^3}{3!} + \dots + \frac{x^n}{n!} + \dots
$$

- 只含偶数项：(e^x + e^{-x}) / 2
- 只含奇数项：(e^x - e^{-x}) / 2





### 生成函数

无穷数列

$$
h_0,\ h_1,\ h_2,\ \dots\ ,\ h_n,\ \dots
$$
的生成函数为无穷级数：
$$
g(x)=h_0+h_1x+h_2x^2+\dots+h_nx^n+\dots
$$
x^n 的系数是数列的第n项 hn。

**组合计数**

观察：

1. 多个级数相乘（级数中每一项的系数都为1），得到一个生成函数；
2. 其中项x^n来自于从每个级数中各选取一项相乘，使得满足 e1 + e2 + e3 = n：

$$
x^{e_1} * x^{e_2} * x^{e_3} = x^n
$$

3. 这样的取法的总数目为方程 e1 + e2 + e3 = n 的整数解个数，它就是项x^n的系数hn。

求解多重集合的组合的方法：

- 有k种元素，元素e1的数目限制为 1 ≤ e1≤ 4，则可将其写成级数形式：x^1 + x^2 + x^3 + x^4，它又等于等比数列求和：x(1-x^4)/(1-x)。
- 将其他元素也根据限制写成级数形式，并转化为多项式分式。
- 将k个级数（分式）相乘，得到一个生成函数，多项式展开，则第n项 x^n 的系数 hn就是该多重集合的组合数。

例子：

一个果篮，放苹果、香蕉、橘子，要求：

- 苹果的个数必须是3的倍数，
- 香蕉的个数大于2小于4，
- 橘子个数大于1。

写出生成函数：
$$
\begin{align}
g(x)&=(1+x^3+x^6+\dots)(x^2+x^3+x^4)(x+x^2+x^3+\dots)\\
&=\frac{1}{1-x^3}*\frac{1-x^3}{1-x}x^2*\frac{x}{1-x}
\end{align}
$$
多项式展开，则 x^n 的系数 hn 就是满足限制条件的n组合数。

（但是很难遇到恰好能用集合级数展开的情况）



### 指数生成函数

以 x^n/n! 作为项，来自于：
$$
e^x=\sum_{n=0}^\infty \frac{x^n}{n!} = 1+x+\frac{x^2}{2!}+\dots+\frac{x^n}{n!}+\dots
$$
指数生成函数
$$
g^{(e)}(x)=\sum_{n=0}^\infty h_n \frac{x^n}{n!} = h_0+h_1x+h_2\frac{x^2}{2!}+\dots+h_n\frac{x^n}{n!}+\dots
$$

- 比普通生成函数（组合）多除一个n!
- 适合涉及二项式系数的计数数列

**排列计数**

观察：

1. 多个指数函数相乘，得到生成函数
2. 从各个级数中取一项相乘

$$
\frac{x^{m_1}}{m_1!} * \frac{x^{m_2}}{m_2!} * \frac{x^{m_3}}{m_3!} = \frac{x^{m_1}x^{m_2}x^{m_3}}{m_1!m_2!m_3!}
$$

3. 则对于满足 m1 + m2 +m3 = n 的式子有

$$
\frac{x^{m_1}x^{m_2}x^{m_3}}{m_1!m_2!m_3!} = \frac{x^n}{m_1!m_2!m_3!} = \frac{n!}{m_1!m_2!m_3!}\frac{x^n}{n!}
$$

4. 发现x^n/n!的系数就是多重集合的排列数
5. 因此生成函数中项x^n/n!的系数是所有满足条件m1 + m2 +m3 = n的n排列数：

$$
\sum\frac{n!}{m_1!m_2!m_3!}
$$

例子：

多重集合，有元素a1、a2、a3，限制条件：

- a1为偶数个
- a2为奇数个
- a3至少有1个

$$
\begin{align}
g^{(e)}(x) &= (1+\frac{x^2}{2!}+\frac{x^4}{4!}+\dots)(x+\frac{x^3}{3!}+\frac{x^5}{5!}+\dots)(x+\frac{x^2}{2!}+\frac{x^3}{3!}+\dots)\\
&=\frac{e^x+e^{-x}}{2}*\frac{e^x-e^{-x}}{2}*(e^x-1)
\end{align}
$$

用指数函数展开为多项式，x^n/n!的系数就是n排列数。





### 求解线性齐次递推关系

递推关系
$$
h_n=a_1h_{n-1} + a_2h_{n-2} +\dots + a_nh_{0} + b_n
$$

- 线性：系数a_n只和n有关
- 齐次：bn=0

##### 方法一：特征方程

步骤

- 根据递推关系写出特征方程（设hn=q^n，q≠0）
- 求特征根
- 得到通解
- 代入初始条件得到特解

例子：
$$
h_n = 4h_{n-1}-4h_{n-2}
$$
写出特征方程
$$
q^2-4q+4=0
$$
解得特征根2为二重根，则有两个解（每有一个**多重根**就多乘一个n）
$$
q_1 = 2^n,\ q_2 = n2^n
$$
得到通解：
$$
h_n = c_12^n+c_2n2^n
$$
代入初始条件h0和h1即可解出c1和c2，得到特解。

##### 方法二：生成函数

步骤：

- 通过凑递推关系=0，消去后面的项
- 得到g(x)=p(x)/q(x)的形式
- 代入初始条件，待定系数分解p(x)/q(x)，将g(x)表示成多个的幂级数（1/1-rx）之和
- 牛顿二项式展开，第n项的系数hn就是递推关系

例子：
$$
h_n = 5h_{n-1} - 6h_{n-2}
$$
则有
$$
h_n - 5h_{n-1} + 6h_{n-2} = 0
$$
设g(x)是数列h0, h1, h2, ...的生成函数
$$
\begin{align}
g(x)&=h_0+h_1x+h_2x^2+\dots+h_nx^n+\dots\\
-5xg(x)&=\quad-5h_0x-5h_1x^2-\dots-5h_{n-1}x^n+\dots\\
6x^2g(x)&=\quad\quad\quad\quad\quad6h_0x^2+\dots+6h_{n-2}x^n+\dots\\
\end{align}
$$
三式相加，由于上式，后面部分都消掉，得
$$
g(x)-5xg(x)+6x^2g(x)=h_0+h_1x-5h_0x
$$
代入h0=1，h1=-2，得到g(x)=p(x)/q(x)
$$
g(x)=\frac{1-7x}{1-5x+6x^2}=\frac{c_1}{1-2x}+\frac{c_2}{1-3x}
$$
求出c1，c2，最后用牛顿二项式展开，第n项的系数hn就是递推关系。

**重根的情况**：

分母因式分解时，发现有重根，几重根就有几个分式，分母的幂次就是根的重数

如下面的例子分母(1-2x)是二重根，所以两个分式，第二个分式的分母的幂次为2；注意分子的阶数不变，总是分母因子的阶数-1。
$$
g(x)=\frac{x}{1+x-16x^2+20x^3} =\frac{c_1}{1-2x}+\frac{c_2}{(1-2x)^2}+\frac{c_3}{1+5x}
$$






### 求解线性非齐次递推关系

非齐次：bn != 0

##### 方法一：特征方程

步骤

- 先求齐次通解（hn = c1q1^n + c2q2^n）
- 求非齐次特解（设hn = ...，代入原递推关系式就可以求出）
- hn = 齐次通解 + 非齐次特解，代入初始条件，确定齐次通解中的常数c

##### 方法二：生成函数

步骤：

- 与齐次时的思路一样，凑递推关系=bn，后面的项都变成bn*x^n（可以表示成一个幂级数1/1-rx）
- 之后与齐次时的步骤一样