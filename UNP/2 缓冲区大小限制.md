## 2.11 缓冲区大小限制

IP层通过数据链路层发送数据报，不同链路层规定了不同的**MTU**（最大传输单元）。

当发送/转发大于MTU的IP数据报时，IP层会进行**分片**。

两个主机之间的最小MTU称为**路径MTU**。

两个方向上的路径MTU通常是不一致的，因为路由选择往往是不对称的。

路径MTU可以通过IPv4的DF位（不分片）来发现。

分片通常会到目的地的IP层才**重组**，有一个**重组缓冲区**。

TCP在SYN分节上添加MSS选项（每个分节的最大数据payload），其值等于路径MTU减去IP和TCP首部的固定长度。这样发送的数据可以试图**避免在IP层的分片**。

### TCP输出

进程调用`write()`向TCP套接字发送缓冲区写入数据，当未能全部写入缓冲区时，被阻塞，直到成功将全部数据写入缓冲区。

发送缓冲区中已发送的数据会被保留，直到收到对端的确认`ACK`后才丢弃。